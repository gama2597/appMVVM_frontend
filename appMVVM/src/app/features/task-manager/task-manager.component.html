<div class="app-container fadein animation-duration-500">
  <p-toast position="bottom-right"></p-toast>
  <p-confirmDialog [style]="{width: '450px'}" [baseZIndex]="10000"></p-confirmDialog>

  <div class="hero-section">
    <div class="hero-content">
      <div class="flex flex-column gap-2">
        <h1 class="hero-title">Gestor de Tareas</h1>
        <p class="hero-subtitle">Tu productividad, organizada y visual.</p>
      </div>
      <button pButton label="Nueva Tarea" icon="pi pi-plus" class="create-btn shadow-4" (click)="openNew()">
      </button>
    </div>
  </div>

  <div class="main-content">

    <div class="stats-grid">
      <div class="stat-card total-card">
        <div class="card-content">
          <div>
            <span class="card-label">Total Tareas</span>
            <div class="card-value">{{ tasks.length }}</div>
          </div>
          <div class="icon-box bg-blue-100 text-blue-600">
            <i class="pi pi-folder-open text-2xl"></i>
          </div>
        </div>
        <div class="card-progress blue"></div>
      </div>

      <div class="stat-card success-card">
        <div class="card-content">
          <div>
            <span class="card-label">Completadas</span>
            <div class="card-value">{{ getCompletedCount() }}</div>
          </div>
          <div class="icon-box bg-green-100 text-green-600">
            <i class="pi pi-check-circle text-2xl"></i>
          </div>
        </div>
        <div class="card-progress green"></div>
      </div>

      <div class="stat-card warn-card">
        <div class="card-content">
          <div>
            <span class="card-label">Pendientes</span>
            <div class="card-value">{{ getPendingCount() }}</div>
          </div>
          <div class="icon-box bg-orange-100 text-orange-600">
            <i class="pi pi-stopwatch text-2xl"></i>
          </div>
        </div>
        <div class="card-progress orange"></div>
      </div>
    </div>

    <div class="table-wrapper shadow-3">
      <p-table [value]="tasks" [loading]="isLoading" [rows]="5" [paginator]="true" [rowsPerPageOptions]="[5, 10, 20]"
        responsiveLayout="scroll" styleClass="modern-table">

        <ng-template pTemplate="header">
          <tr>
            <th style="width: 10%" class="pl-4">ID</th>
            <th style="width: 45%">DESCRIPCIÓN</th>
            <th style="width: 25%">ESTADO</th>
            <th style="width: 20%; text-align: right" class="pr-4">ACCIONES</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-task>
          <tr class="table-row">
            <td class="pl-4"><span class="id-badge">#{{ task.id }}</span></td>
            <td>
              <span class="task-title" [ngClass]="{'completed-text': task.completado}">
                {{ task.titulo }}
              </span>
            </td>
            <td>
              <div class="status-badge" [ngClass]="task.completado ? 'status-success' : 'status-pending'">
                <i class="pi" [ngClass]="task.completado ? 'pi-check' : 'pi-spin pi-spinner'"></i>
                <span>{{ task.completado ? 'Completada' : 'En Progreso' }}</span>
              </div>
            </td>
            <td style="text-align: right" class="pr-4">
              <div class="flex justify-content-end gap-2">
                <button class="action-btn edit shadow-1" (click)="editTask(task)" pTooltip="Editar"
                  tooltipPosition="top">
                  <i class="pi pi-pencil"></i>
                </button>
                <button class="action-btn delete shadow-1" (click)="deleteTask(task)" pTooltip="Eliminar"
                  tooltipPosition="top">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="4" class="text-center p-6 bg-white border-round-bottom-xl">
              <div class="flex flex-column align-items-center gap-3 opacity-60">
                <i class="pi pi-filter-slash text-5xl text-400"></i>
                <span class="font-medium text-lg text-600">No hay tareas para mostrar</span>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

  <p-dialog [(visible)]="taskDialog" [style]="{width: '450px'}" [header]="isEditing ? 'Editar Tarea' : 'Nueva Tarea'"
    [modal]="true" styleClass="p-fluid custom-dialog" [draggable]="false" [resizable]="false">

    <ng-template pTemplate="content">
      <div class="flex flex-column gap-4 mt-3">
        <div class="field">
          <label for="titulo" class="font-semibold text-700 mb-2 block">Título de la tarea</label>
          <input type="text" pInputText id="titulo" [(ngModel)]="currentTask.titulo" required autofocus
            placeholder="Escribe aquí..." class="custom-input" />
          <small class="p-error block mt-2" *ngIf="!currentTask.titulo">El título es requerido.</small>
        </div>

        <div
          class="field-checkbox p-3 surface-50 border-1 border-round-lg hover:surface-100 transition-colors cursor-pointer flex align-items-center gap-3">
          <p-checkbox [(ngModel)]="currentTask.completado" [binary]="true" inputId="binary"></p-checkbox>
          <label for="binary" class="cursor-pointer font-medium text-800 flex-grow-1">Marcar como completada</label>
        </div>
      </div>
    </ng-template>

    <ng-template pTemplate="footer">
      <div class="flex justify-content-end gap-2 mt-4">
        <button pButton label="Cancelar" class="p-button-text text-500" (click)="taskDialog = false"></button>
        <button pButton label="Guardar" icon="pi pi-check" class="p-button-primary border-round-lg px-4"
          (click)="saveTask()"></button>
      </div>
    </ng-template>
  </p-dialog>
</div>
